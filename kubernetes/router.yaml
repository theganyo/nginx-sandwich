apiVersion: v1
kind: Service
metadata:
  name: router
  labels:
    app: router
spec:
  type: NodePort
  ports:
    - name: inbound
      port: 80
      targetPort: 8080
      protocol: TCP
    - name: outbound
      port: 8081
      targetPort: 8081
      protocol: TCP
  selector:
    app: gateway
  externalIPs:
  - 172.17.4.101
---
apiVersion: v1
kind: ReplicationController
metadata:
  name: gateway
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: gateway
    spec:
      containers:
      - name: nginx
        image: scottganyo/nginx-sandwich-nginx
        ports:
        - name: inbound
          containerPort: 8080 # inbound
        - name: outbound
          containerPort: 8081 # outbound
      - name: micro-gateway
        image: scottganyo/nginx-sandwich-gateway
        ports:
        - name: service
          containerPort: 10010
        env:
        - name: outbound
          value: http://router:8081
#---
#apiVersion: v1
#kind: Service
#metadata:
#name: target
#labels:
#  app: target
#spec:
#type: NodePort
#ports:
#  - port: 10010
#    targetPort: 10010
#selector:
#  app: target
#---
#apiVersion: v1
#kind: ReplicationController
#metadata:
#name: target
#spec:
#replicas: 1
#template:
#  metadata:
#    labels:
#      app: target
#  spec:
#    containers:
#    - name: target
#      image: scottganyo/nginx-sandwich-target
#      ports:
#      - containerPort: 10010
