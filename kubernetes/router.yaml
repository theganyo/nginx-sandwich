apiVersion: v1
kind: Service
metadata:
  name: nginx-inbound
spec:
  type: NodePort
  ports:
    - port: 80
      targetPort: 8080
  selector:
    app: ingester
  externalIPs:
  - 192.168.64.128
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-outbound
spec:
  type: NodePort
  ports:
    - port: 80
      targetPort: 8081
  selector:
    app: ingester
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-gateway
spec:
  type: NodePort
  ports:
    - port: 80
      targetPort: 10010
  selector:
    app: ingester
---
apiVersion: v1
kind: ReplicationController
metadata:
  name: ingester
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: ingester
    spec:
      containers:
      - name: nginx
        image: scottganyo/nginx-sandwich-nginx
        ports:
        - containerPort: 8080 # inbound
        - containerPort: 8081 # outbound
      - name: micro-gateway
        image: scottganyo/nginx-sandwich-gateway
        ports:
        - containerPort: 10010
        env:
        - name: outbound
          value: http://nginx-outbound
#---
#apiVersion: v1
#kind: Service
#metadata:
#name: target
#labels:
#  app: target
#spec:
#type: NodePort
#ports:
#  - port: 10010
#    targetPort: 10010
#selector:
#  app: target
#---
#apiVersion: v1
#kind: ReplicationController
#metadata:
#name: target
#spec:
#replicas: 1
#template:
#  metadata:
#    labels:
#      app: target
#  spec:
#    containers:
#    - name: target
#      image: scottganyo/nginx-sandwich-target
#      ports:
#      - containerPort: 10010
